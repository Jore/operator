'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _tarry=require('tarry.js'),_util=require('./util'),parser=new window.DOMParser,parseResponse=function(a){return parser.parseFromString(a,'text/html')},evalScripts=function(source){var root=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,errors=[],scripts=Array.prototype.slice.call(source.getElementsByTagName('script')),existing=root?Array.prototype.slice.call(root.getElementsByTagName('script')):[],dupe=function(a){return 0<existing.filter(function(b){return a.innerHTML===b.innerHTML&&a.src===b.src}).length};0<scripts.length&&scripts.forEach(function(t){var s=t.cloneNode(!0);if(!dupe(s)){s.setAttribute('data-ajaxed','true');try{eval(s.innerHTML)}catch(a){errors.push(a)}try{root?root.insertBefore(s,root.children[0]):source.replaceChild(s,t)}catch(a){errors.push(a),document.head.insertBefore(s,document.head.children[0])}}}),0<errors.length&&(console.groupCollapsed('operator.js'),errors.forEach(function(a){return console.log(a)}),console.groupEnd())},returnSize=function(a,b){var c=null!==a&&a.window;return c?Math.max(a['outer'+b],document.documentElement['client'+b]):Math.max(a['offset'+b],a['client'+b])};exports.default=function(a,b,c){return function(d,f){var g=parseResponse(d),h=g.head.getElementsByTagName('title')[0].innerHTML,i=document.querySelector(a),j=(0,_tarry.tarry)(function(){c.emit('before:transition'),document.documentElement.classList.add('is-transitioning'),i.style.height=returnSize(i,'Height')+'px'},b),k=(0,_tarry.tarry)(function(){i.innerHTML=g.querySelector(a).innerHTML,f(h,i),evalScripts(i),evalScripts(g.head,document.head),(0,_util.restoreScrollPos)()},b),l=(0,_tarry.tarry)(function(){document.documentElement.classList.remove('is-transitioning'),i.style.height=''},b),m=(0,_tarry.tarry)(function(){return c.emit('after:transition')},b);(0,_tarry.queue)(j,k,l,m)()}};